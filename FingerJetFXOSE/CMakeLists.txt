cmake_minimum_required (VERSION 3.3)

project( FingerJetFXOSE )

set( NO_SEARCH TRUE )

# set colors for cmake comand line
string(ASCII 27 Esc)
set(Na "${Esc}[m")
set(Rd "${Esc}[31m")
set(Gn "${Esc}[32m")
set(Ye "${Esc}[33m")
set(Bl "${Esc}[34m")
set(Pk "${Esc}[35m")
set(Gy "${Esc}[37m")

# detect target platform
if( WIN32 ) 
  if( ( CMAKE_SIZEOF_VOID_P EQUAL 8 AND NOT 32BITS ) OR 64BITS )
    set(TARGET_PLATFORM "win64")
  else()
    set(TARGET_PLATFORM "win32")
  endif()
elseif( ANDROID )
  if( X86 )
    if( ( CMAKE_SIZEOF_VOID_P EQUAL 8 AND NOT 32BITS ) OR 64BITS )
      set(TARGET_PLATFORM "android-x86-64")
    else()
      set(TARGET_PLATFORM "android-x86-32")
    endif()
  else()
    if( ( CMAKE_SIZEOF_VOID_P EQUAL 8 AND NOT 32BITS ) OR 64BITS )
      set(TARGET_PLATFORM "android-arm64")
    else()
      set(TARGET_PLATFORM "android-arm32")
    endif()
  endif()
elseif( APPLE )
  if( ( CMAKE_SIZEOF_VOID_P EQUAL 8 AND NOT 32BITS ) OR 64BITS )
    set(TARGET_PLATFORM "apple64")
  else()
    set(TARGET_PLATFORM "apple32")
  endif()
elseif( UNIX )
  if( ( CMAKE_SIZEOF_VOID_P EQUAL 8 AND NOT 32BITS ) OR 64BITS )
    set(TARGET_PLATFORM "linux64")
  else()
    set(TARGET_PLATFORM "linux32")
  endif()
endif()

# detect compiler
if ("${CMAKE_CXX_COMPILER_ID}" STREQUAL "AppleClang")
  message( "${Gn}Detected AppleClang compiler${Na}" )
  add_definitions( "-O3 -fPIC -fvisibility=hidden" )
elseif ("${CMAKE_CXX_COMPILER_ID}" STREQUAL "Clang")
  message( "${Gn}Detected Clang compiler${Na}" )
  add_definitions( "-O3 -fPIC -fvisibility=hidden" )
elseif ("${CMAKE_CXX_COMPILER_ID}" STREQUAL "GNU")
  message( "${Gn}Detected GNU compiler${Na}" )
  add_definitions( "-O3 -std=c++11 -fvisibility=hidden -Wno-unknown-pragmas -Wno-unused-but-set-variable")
  if(NOT "${TARGET_PLATFORM}" MATCHES "win*")
    add_definitions( "-fPIC -fvisibility=hidden")
  endif()
elseif ("${CMAKE_CXX_COMPILER_ID}" STREQUAL "Intel")
  message( "${Gn}Detected Intel compiler${Na}" )
elseif ("${CMAKE_CXX_COMPILER_ID}" STREQUAL "MSVC")
  message( "Detected MSVC compiler" )
  add_definitions( "/W3 /D_CRT_SECURE_NO_WARNINGS /wd4005 /wd4996 /nologo /MT" )
else()
  message( "Detected ${CMAKE_CXX_COMPILER_ID}" )
endif()

if( 32BITS)
  set( CMAKE_C_FLAGS "-m32")
  set( CMAKE_CXX_FLAGS "-m32") 
elseif( 64BITS)
  set( CMAKE_C_FLAGS "-m64")
  set( CMAKE_CXX_FLAGS "-m64") 
endif()


set( ROOT_PATH ${PROJECT_SOURCE_DIR} )
set( BUILD_PATH  ${CMAKE_CURRENT_BINARY_DIR} )

get_filename_component(CXXTEST_PATH "../cxxtest" ABSOLUTE BASE_DIR "${ROOT_PATH}")

# create distribution path( 3 parts)
# 1st
if ("${CMAKE_CXX_COMPILER_ID}" STREQUAL "MSVC")
  set( DIST_PATH  ${ROOT_PATH}/dist )
else()
  get_filename_component( tmp ${BUILD_PATH}/.. ABSOLUTE   )
  get_filename_component( tmp ${tmp} NAME  )
  set( DIST_PATH  ${ROOT_PATH}/dist/${tmp} )
endif()
# 2nd
get_filename_component( tmp ${BUILD_PATH} ABSOLUTE   )
get_filename_component( tmp ${tmp} NAME  )
set( DIST_PATH  ${DIST_PATH}/${tmp} )

message( STATUS "----- Configuring ${PROJECT_NAME} -----" ) 
message( STATUS "-- Project root path: '${ROOT_PATH}'" )
message( STATUS "-- Project build path: '${BUILD_PATH}'" )
message( STATUS "-- Project distribution path: '${DIST_PATH}'" )

set( CMAKE_ARCHIVE_OUTPUT_DIRECTORY ${DIST_PATH} )
set( CMAKE_LIBRARY_OUTPUT_DIRECTORY ${DIST_PATH} )
set( CMAKE_RUNTIME_OUTPUT_DIRECTORY ${DIST_PATH} )

add_subdirectory("${ROOT_PATH}/src/libFRFXLL/src/" "${BUILD_PATH}/src/libFRFXLL/src/")
add_subdirectory("${ROOT_PATH}/src/libFRFXLL/test/TestVectors/" "${BUILD_PATH}/src/libFRFXLL/test/TestVectors/")
add_subdirectory("${ROOT_PATH}/src/libFRFXLL/test/testFRFXLL/" "${BUILD_PATH}/src/libFRFXLL/test/testFRFXLL/")
add_subdirectory("${ROOT_PATH}/src/libFRFXLL/test/testFRFXLLInternals/" "${BUILD_PATH}/src/libFRFXLL/test/testFRFXLLInternals/")
add_subdirectory("${ROOT_PATH}/src/libFRFXLL/samples/FRFXLLSample/" "${BUILD_PATH}/src/libFRFXLL/samples/FRFXLLSample/")




